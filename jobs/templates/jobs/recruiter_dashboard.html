{% extends 'jobs/base.html' %}
{% block title %}Recruiter Dashboard ‚Äî TalentMatch{% endblock %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div>
        <h1>Recruiter Dashboard</h1>
        <p style="color: #718096;">{{ user.profile.company_name|default:"Your Company" }} ‚Äî manage your job posts and applicants.</p>
    </div>
    <a href="{% url 'post_job' %}" class="btn btn-success">+ Post a Job</a>
</div>

{% if not job_data %}
<div class="card" style="text-align: center; padding: 3rem; color: #718096;">
    <div style="font-size: 3rem;">üìã</div>
    <h2>No jobs posted yet</h2>
    <a href="{% url 'post_job' %}" class="btn btn-success" style="margin-top: 1rem;">Post Your First Job</a>
</div>
{% endif %}

{% for item in job_data %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
        <div>
            <h2>{{ item.job.title }}</h2>
            <div style="font-size: 0.85rem; color: #718096;">
                üìç {{ item.job.location }}
                &nbsp;|&nbsp; ‚è± {{ item.job.get_required_experience_level_display }}
                &nbsp;|&nbsp; Posted {{ item.job.created_at|timesince }} ago
            </div>
        </div>
        <div style="display:flex; align-items:center; gap:0.5rem;">
    
    <span class="badge badge-blue" style="font-size: 0.9rem;">
        {{ item.count }} applicant{{ item.count|pluralize }}
    </span>

    <!-- ‚úÖ Delete Button -->
    <form method="POST"
          action="{% url 'delete_job' item.job.id %}"
          onsubmit="return confirm('Are you sure you want to delete this job?');"
          style="margin:0;">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-danger">
            Delete Job
        </button>
    </form>

</div>

    </div>

    {% if item.applications %}
    <div style="margin-top: 1rem; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 0.88rem;">
            <thead>
                <tr style="background: #f8fafc; text-align: left;">
                    <th style="padding: 0.6rem;">Candidate</th>
                    <th style="padding: 0.6rem;">Skills</th>
                    <th style="padding: 0.6rem; text-align: center;">Match Score</th>
                    <th style="padding: 0.6rem;">Status</th>
                    <th style="padding: 0.6rem;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for app in item.applications %}
                <tr style="border-top: 1px solid #f0f4f8;">
                    <td style="padding: 0.6rem;">
                        <strong>{{ app.candidate.get_full_name|default:app.candidate.username }}</strong>
                        <div style="color: #718096; font-size: 0.78rem;">{{ app.candidate.profile.get_experience_level_display }}</div>
                    </td>
                    <td style="padding: 0.6rem; max-width: 200px;">
                        {% for skill in app.candidate.profile.get_skills_list|slice:":4" %}
                            <span class="skill-tag">{{ skill }}</span>
                        {% endfor %}
                    </td>
                    <td style="padding: 0.6rem; text-align: center;">
                        <div style="font-weight: 700; font-size: 1rem;
                            color: {% if app.points_total >= 50 %}#065f46{% elif app.points_total >= 25 %}#92400e{% else %}#991b1b{% endif %};">
                            üéØ {{ app.points_total }}
                        </div>
                    </td>
                    <td style="padding: 0.6rem;">
                        <span class="badge
                            {% if app.status == 'hired' %}badge-green
                            {% elif app.status == 'shortlisted' %}badge-blue
                            {% elif app.status == 'reviewed' %}badge-yellow
                            {% elif app.status == 'rejected' %}badge-red
                            {% else %}badge-purple{% endif %}">
                            {{ app.get_status_display }}
                        </span>
                    </td>
                    <td style="padding: 0.6rem;">
                        <div style="display: flex; gap: 0.3rem; flex-wrap: wrap;">
                            <a href="{% url 'update_status' app.pk 'reviewed' %}" class="btn btn-sm" style="background:#fef3c7;color:#92400e;">Review</a>
                            <a href="{% url 'update_status' app.pk 'shortlisted' %}" class="btn btn-sm btn-primary">Shortlist</a>
                            <a href="{% url 'update_status' app.pk 'hired' %}" class="btn btn-sm btn-success">Hire</a>
                            <a href="{% url 'update_status' app.pk 'rejected' %}" class="btn btn-sm btn-danger">Reject</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="color: #a0aec0; margin-top: 1rem; font-style: italic;">No applications yet.</p>
    {% endif %}
</div>
{% endfor %}
{% endblock %}
